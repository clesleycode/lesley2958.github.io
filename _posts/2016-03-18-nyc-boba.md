---
layout: post
title: Boba with Python & Google Maps
tags: boba food
categories: food
---


If you plant me anywhere in Manhattan, I can probably tell you where the nearest bubble tea place is with a great deal of confidence. This is partially because I have a lot of them memorized, but my the boba map on my [data blog]() also comes in handy for the times my memory betrays me. 

In this tutorial, we'll use a combination of Python, the Google Maps API, and geojsonio to create what can only be described as the most important tool in the world: a boba map. 

### Environment Setup 

But before we even get started with guide, we have to set our environment up! 

This guide was written in Python 3.6. If you haven't already, download Python and Pip. Next, you’ll need to install several packages that we’ll use throughout this tutorial:

```
pip3 install googlemaps
pip3 install geocoder
pip3 install geojsonio
```

Since we'll be using the Google Maps API, make sure to generate an API key [here](https://developers.google.com/maps/documentation/geocoding/get-api-key). 

Lastly, you can download all the data for this workshops here. And now we're ready to start!

For this task, we're going to take an object-oriented programming approach. We'll create a class called `BubbleTea` to take care of the processing and methods we'll need for our bot. To accomplish this, we'll begin by using the `googlemaps` API module to initialize our authentication, and `pandas` to read in the CSV.

``` python
import pandas as pd 
import googlemaps

class BubbleTea(object):

# authentication initialized
gmaps = googlemaps.Client(key='AIzaSyBGPTP8qLp3UGFgx_nlYjQ4L5yT25gRzr4')

def __init__(self, filename):
self.boba = pd.read_csv(filename)
```

In the code sample above, I've included the googlemaps initialization before the constructor since this API key shouldn't necessarily change. In the constructor, however, we need the filename of the boba places as a parameter so we can use pandas to read it in as a DataFrame.

Just so that we know what we're working with, let's take a look at the file containing bubble tea places:


```python
import pandas as pd
pd.read_csv("./boba.csv").head()
```




<div>
<style>
.dataframe thead tr:only-child th {
text-align: right;
}

.dataframe thead th {
text-align: left;
}

.dataframe tbody tr th {
vertical-align: top;
}
</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th></th>
<th>Name</th>
<th>Address</th>
</tr>
</thead>
<tbody>
<tr>
<th>0</th>
<td>Boba Guys</td>
<td>11 Waverly Pl New York, NY 10002</td>
</tr>
<tr>
<th>1</th>
<td>Bubble Tea &amp; Crepes</td>
<td>251 5th Ave, New York, NY 10016</td>
</tr>
<tr>
<th>2</th>
<td>Bubbly Tea</td>
<td>55B Bayard St New York, NY 10013</td>
</tr>
<tr>
<th>3</th>
<td>Cafe East</td>
<td>2920 Broadway, New York, NY 10027</td>
</tr>
<tr>
<th>4</th>
<td>Coco Bubble Tea</td>
<td>129 E 45th St New York, NY 10017</td>
</tr>
</tbody>
</table>
</div>



As you can see, it's just a simple DataFrame containing two columns: one with the name of the bubble tea place and its address. 

To visualize each bubble tea place as a point on a map, we have to convert the addresses into coordinates. Eventually, we'll use these coordinates to create `shapely` Point geospatial objects. 

But first, let's review how these coordinates are obtained:

Because we don't have the latitude nor longitude, we'll use the `geocoder` and `googlemaps` modules to request the coordinates. Below you can see the API request with `geocoder.google()`. As a parameter, we provide the address which will be used to create the geospatial object. For this example, I've used the address of a building at Columbia University. 


```python
import googlemaps
import geocoder

gmaps = googlemaps.Client(key='AIzaSyBGPTP8qLp3UGFgx_nlYjQ4L5yT25gRzr4')

geocoder.google("2920 Broadway, New York, NY 10027")
```




<[OK] Google - Geocode [Alfred Lerner Hall, 2920 Broadway, New York, NY 10027, USA]>



This geospatial object has multiple attributes you can utilize, which you can read the documentation about [here](). For the purpose of this tutorial, we'll be using the `lat` and `lng` attributes. 


```python
geocoder.google("2920 Broadway, New York, NY 10027").lat
```




40.8069421




```python
geocoder.google("2920 Broadway, New York, NY 10027").lng
```




-73.9639939



With that said, let's use the code we've reviewed above to add three columns to our boba CSV DataFrame: `Latitude`, `Longitude`, and `Coordinates`. The workflow for this function will be created the longitude and latitude columns, and then using these columns to create the Point geospatial object with shapely.

``` python
import geocoder
from shapely.geometry import Point

def calc_coords(self): 
self.boba['Lat'] = self.boba['Address'].apply(geocoder.google).apply(lambda x: x.lat)
self.boba['Longitude'] = self.boba['Address'].apply(geocoder.google).apply(lambda x: x.lng)
self.boba['Coordinates'] = [Point(xy) for xy in zip(self.boba.Longitude, self.boba.Lat)]
```

The final step for this project is to visualize the geospatial data using `geojsonio`. But to use `geojsonio`, we need to convert the DataFrame above into geojson. Unfortunately it's not as straightforward because our original data was in a CSV format. Fortunately, we can convert this with a few lines of code. More specifically, we'll great three get methods for our `visualize()` function to work. 

The first, `get_geo()` returns the coordinates as a list:

``` python
def get_geo(self):
return(list(self.boba['Coordinates']))
```

`get_names()` returns the Name column as series. 

``` python
def get_names(self):
return(self.boba['Name'])
```

And finally, `get_gdf()` converts all the data into a GeoDataFrame and then returns a GeoDataFrame. This is where we utilize the two previous functions since the first parameter requires the indices to be a series and the `geometry` parameter requires a list.  

``` python
from geopandas import GeoDataFrame

def get_gdf(self):
crs = {'init': 'epsg:4326'}
return(GeoDataFrame(self.get_names(), crs=crs, geometry=self.get_geo()))
```



Great! Now let's use `geojsonio` for some boba fun! Now that we have all our helper functions implemented, we can use them to deploy our visualization with `geojsonio`'s `display()` function. 

``` python
from geojsonio import display

def visualize(self):
self.boba['Coordinates'] = [Point(xy) for xy in zip(self.boba.Longitude, self.boba.Lat)]
updated = self.get_gdf()
display(updated.to_json()) 
```

Now that we've carefully reviewed the code associated with this exercise, let's put it all together and run it! 


```python
import pandas as pd 
import geocoder 
import googlemaps
from shapely.geometry import Point
from geopandas import GeoDataFrame
from geojsonio import display


class BubbleTea(object):

# authentication initialized
gmaps = googlemaps.Client(key='AIzaSyBGPTP8qLp3UGFgx_nlYjQ4L5yT25gRzr4')

# filename: file with list of bubble tea places and addresses
def __init__(self, filename):
# initalizes csv with list of bubble tea places to dataframe
self.boba = pd.read_csv(filename)

# calc_coordinates: pulls coordinates from google maps and adds to dataframe
def calc_coords(self): 
# gets latitude and longitudes of each place
self.boba['Lat'] = self.boba['Address'].apply(geocoder.google).apply(lambda x: x.lat)
self.boba['Longitude'] = self.boba['Address'].apply(geocoder.google).apply(lambda x: x.lng)
# converts lat and long points to coordinate point data type
self.boba['Coordinates'] = [Point(xy) for xy in zip(self.boba.Longitude, self.boba.Lat)]

# get_geo: returns all coordinates as a list
def get_geo(self):
return(list(self.boba['Coordinates']))

# get_names: get method for names column
def get_names(self):
return(self.boba['Name'])

# get_gdf: returns geoDataFrame of needed data
def get_gdf(self):
# coordinate system parameters
crs = {'init': 'epsg:4326'}
return(GeoDataFrame(self.get_names(), crs=crs, geometry=self.get_geo()))

# get method for the entire boba dataframe
def get_boba(self):
return(self.boba)

# visualizes the geojson using geojsonio
def visualize(self):
self.boba['Coordinates'] = [Point(xy) for xy in zip(self.boba.Longitude, self.boba.Lat)]
updated = self.get_gdf()
display(updated.to_json())
```

First, we initialize the class with our boba file. Remember, this only initializes what's in the constructor, so as of now, we only have a pandas DataFrame created.


```python
boba = BubbleTea("./boba.csv")
```

Next we call the `calc_coords()` method. Recall that this function makes API calls to google maps for the latitude and longitude and then takes these two columns to convert to a shapely Point object. 

Because of the many Google Maps API calls, expect this to take a while. 


```python
boba.calc_coords()
```

The longest part is over! Now we're ready for our awesome boba map:


```python
boba.visualize()
```

This gets us a beautiful interactive map we can then use for whatever purposes. I choice to include it in a Github Gist, but `geojsonio` has a lot of different ways of sharing your content, so feel free to choose whatever fits your needs. 

![image.png](attachment:image.png)

And that's a wrap! If you'd like to learn more about geospatial analysis, check out the following resources:

[GeoJSON](http://geojson.org/) <br>
[OpenStreetMap](https://www.openstreetmap.org/#map=5/51.500/-0.100) <br>
[CartoDB](https://carto.com/)


```python

```
